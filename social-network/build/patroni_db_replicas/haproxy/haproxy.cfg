global
    log stdout format raw local0

defaults
    log global
    mode tcp
    retries 2
    timeout connect 5s
    timeout client  30s
    timeout server  30s

frontend write
    bind *:5000
    default_backend master

backend master
    mode tcp
    option httpchk GET /master
    http-check expect status 200
    server patroni1 patroni1:5432 check port 8008
    server patroni2 patroni2:5432 check port 8008
    server patroni3 patroni3:5432 check port 8008

frontend read
    bind *:5001
    default_backend replicas

backend replicas
    mode tcp
    balance roundrobin
    option httpchk GET /replica
    http-check expect status 200
    default-server inter 2s fall 3 rise 2
    server patroni1 patroni1:5432 check port 8008
    server patroni2 patroni2:5432 check port 8008
    server patroni3 patroni3:5432 check port 8008
